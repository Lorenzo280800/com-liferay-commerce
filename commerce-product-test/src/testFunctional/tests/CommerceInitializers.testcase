@component-name = "portal-commerce"
definition {

	property portal.acceptance = "true";
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Commerce";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			User.logoutAndLoginPG(
				password = "test",
				userLoginEmailAddress = "test@liferay.com");

			CommerceConfiguration.commerceFrontStoreTearDown();

			CommerceConfiguration.commerceAdminTearDown(accountName = "Commerce Account");

			CommerceConfiguration.commerceInitializersTearDown();

			User.logoutPG();

		}
	}

	test MiniumSiteFullFlow {

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.addCP(
			userEmailAddress = "buyer@liferay.com",
			userFirstName = "Buyer",
			userLastName = "User",
			userScreenName = "buyer");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.editPasswordCP(
			newPassword = "ttest",
			userEmailAddress = "buyer@liferay.com",
			userScreenName = "buyer");

		CommerceAccelerators.initializeAccelerator(siteName = "Minium");

		ProductMenu.gotoSiteViaLink(site = "Minium");

		Navigator.openSpecificURL(url = "http://localhost:8080/group/Minium");

		CommerceAcceleratorsInitializer.createNewAccountViaFront(
			accountName = "Commerce Account",
			adminEmailAddress = "test@liferay.com");

		CommerceAcceleratorsInitializer.addExistingMemberWithRoleToAccount(
			userEmailAddress = "buyer@liferay.com",
			userFirstName = "Buyer");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Accounts");

		LexiconEntry.gotoEntryMenuItemNoError(
			menuItem = "Edit",
			rowEntry = "Commerce Account");

		Click(locator1 = "NavBar#ADDRESSES");

		Click(locator1 = "Button#PLUS");

		CommerceEntry.addNewAddressToAccountFromAdmin(
			addressAddress = "Test Address",
			addressCity = "Test City",
			addressCountry = "United States",
			addressName = "Commerce Address",
			addressZipCode = "Test Zip Code");

		User.logoutAndLoginPG(
			password = "test",
			userLoginEmailAddress = "buyer@liferay.com");

		ProductMenu.gotoSite(site = "Minium");

		Navigator.openSpecificURL(url = "http://localhost:8080/group/Minium");

		FrontStore.addInitializerProductToCart(
			productName = "ABS Sensor",
			productQuantity = "2",
			productUnitPrice = "50.00");

		CommerceAcceleratorsInitializer.commerceMiniumReviewOrder(
			accountName = "Commerce Account",
			menuItem = "Pending Orders",
			orderAuthor = "Buyer User",
			productQuantity = "2",
			productSKU = "MIN93015",
			productUnitPrice = "50.00");

		CommerceCheckout.initializersCheckout(
			addressName = "Commerce Address",
			deliveryType = "Standard Delivery",
			site = "Minium");

		CommerceAcceleratorsInitializer.commerceMiniumReviewOrder(
			accountName = "Commerce Account",
			menuItem = "Placed Orders",
			orderAuthor = "Buyer User",
			productQuantity = "2",
			productSKU = "MIN93015",
			productUnitPrice = "50.00");
	}

	test SpeedwellSiteFullFlow {

		CommerceAccelerators.initializeAccelerator(siteName = "Speedwell");

		ProductMenu.gotoSiteViaLink(site = "Speedwell");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Accounts");

		LexiconEntry.gotoEntryMenuItemNoError(
			menuItem = "Edit",
			rowEntry = "Test Test");

		Click(locator1 = "NavBar#ADDRESSES");

		Click(locator1 = "Button#PLUS");

		CommerceEntry.addNewAddressToAccountFromAdmin(
			addressAddress = "Test Address",
			addressCity = "Test City",
			addressCountry = "United States",
			addressName = "Commerce Address",
			addressZipCode = "Test Zip Code");

		ProductMenu.gotoSite(site = "Speedwell");

		ProductMenuHelper.closeProductMenu();

		Click(locator1 = "CommerceAccelerators#SPEEDWELL_TOPBAR");

		Click(
			key_menuItem = "Catalog",
			locator1 = "CommerceAccelerators#SPEEDWELL_TOPBAR_LINK");

		FrontStore.addInitializerProductToCart(
			productName = "ABS Sensor",
			productQuantity = "2",
			productUnitPrice = "50.00");

		Click(locator1 = "CommerceAccelerators#SPEEDWELL_TOPBAR");

		Click(
			key_menuItem = "My Cart",
			locator1 = "CommerceAccelerators#SPEEDWELL_TOPBAR_LINK");

		CommerceAcceleratorsInitializer.commerceSpeedwellReviewOrder(
			productName = "ABS Sensor",
			productPrice = "100.00",
			productUnitPrice = "50.00");

		ProductMenuHelper.closeProductMenu();

		CommerceCheckout.initializersCheckout(
			addressName = "Commerce Address",
			deliveryType = "Standard Delivery",
			site = "Speedwell");

		Click(locator1 = "CommerceAccelerators#SPEEDWELL_TOPBAR");

		Click(
			key_menuItem = "My Account",
			locator1 = "CommerceAccelerators#SPEEDWELL_TOPBAR_LINK");

		Click(
			key_dashboardItem = "My Orders",
			locator1 = "CommerceAccelerators#SPEEDWELL_ACCOUNT_DASHBOARD_ITEM");

		CommerceAcceleratorsInitializer.commerceSpeedwellReviewOrder(
			accountName = "Test Test",
			productName = "ABS Sensor",
			productPrice = "100.00",
			productQuantity = "2",
			productUnitPrice = "50.00");
	}

}